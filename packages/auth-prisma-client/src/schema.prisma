// This is your Prisma schema file for Auth Service
// Learn more about https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../../../packages/auth-prisma-client/src"
}

datasource db {
  provider = "postgresql"
}

// User model for authentication
model user {
  id             String   @id @default(uuid())
  email          String   @unique
  password_hash  String
  first_name     String?
  last_name      String?
  is_active      Boolean  @default(true)
  email_verified Boolean  @default(false)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  // Relations
  oauth_tokens   oauth_token[]
  refresh_tokens refresh_token[]

  @@map("user")
}

// OAuth 2.0 Client
model oauth_client {
  id            String   @id @default(uuid())
  client_id     String   @unique
  client_secret String
  name          String
  redirect_uris String // JSON array of strings
  scopes        String // JSON array of strings
  grant_types   String // JSON array of strings
  is_active     Boolean  @default(true)
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  // Relations
  oauth_tokens oauth_token[]

  @@map("oauth_client")
}

// OAuth 2.0 Access Token
model oauth_token {
  id         String    @id @default(uuid())
  token      String    @unique
  user_id    String
  client_id  String
  scope      String?
  expires_at DateTime?
  created_at DateTime  @default(now())

  // Relations
  user   user         @relation(fields: [user_id], references: [id], onDelete: Cascade)
  client oauth_client @relation(fields: [client_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@map("oauth_token")
}

// Refresh Token (for token rotation)
model refresh_token {
  id         String    @id @default(uuid())
  token      String    @unique
  user_id    String
  expires_at DateTime
  revoked_at DateTime?
  created_at DateTime  @default(now())

  // Relations
  user user @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@map("refresh_token")
}

// Verification Token for email verification
model verification_token {
  id         String   @id @default(uuid())
  user_id    String
  token      String   @unique
  type       String // 'email', 'password_reset', etc.
  expires_at DateTime
  created_at DateTime @default(now())

  @@index([user_id])
  @@map("verification_token")
}
